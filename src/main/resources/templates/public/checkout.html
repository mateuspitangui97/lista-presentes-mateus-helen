<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head('Pagamento - ' + ${item.nome})}"></head>
<body>

<header th:replace="~{fragments/header :: header}"></header>
<nav th:replace="~{fragments/header :: nav-public}"></nav>

<main class="container">
    <div class="page-content">
        <h2 class="page-title">Finalizar Presente</h2>

        <div class="checkout-wrapper">
            <!-- Coluna Esquerda: Resumo do Item -->
            <div class="checkout-summary">
                <div class="summary-item">
                    <img th:if="${item.imagemUrl != null and !item.imagemUrl.isEmpty()}"
                         th:src="${item.imagemUrl}" th:alt="${item.nome}">
                    <div th:unless="${item.imagemUrl != null and !item.imagemUrl.isEmpty()}" class="summary-placeholder">
                        &#127873;
                    </div>
                    <h3 th:text="${item.nome}">Nome do Produto</h3>
                    <div class="summary-price" th:text="${#numbers.formatCurrency(item.valor)}">R$ 0,00</div>
                </div>

                <!-- Dados do PIX -->
                <div class="pix-section" th:if="${config != null and (config.pixChave != null or config.pixQrcodeUrl != null)}">
                    <h4>Pague via PIX</h4>

                    <!-- QR Code -->
                    <div th:if="${config.pixQrcodeUrl != null and !config.pixQrcodeUrl.isEmpty()}" class="qrcode-box">
                        <img th:src="${config.pixQrcodeUrl}" alt="QR Code PIX" class="qrcode-img">
                        <p>Escaneie o QR Code com o app do seu banco</p>
                    </div>

                    <!-- Ou separador -->
                    <div th:if="${config.pixQrcodeUrl != null and config.pixChave != null}" class="pix-divider">
                        <span>ou copie a chave</span>
                    </div>

                    <!-- Chave PIX -->
                    <div th:if="${config.pixChave != null and !config.pixChave.isEmpty()}" class="pix-key-box">
                        <div class="pix-key-label">
                            <span th:text="${config.pixTipo != null ? config.pixTipo : 'Chave PIX'}">Chave</span>
                        </div>
                        <div class="pix-key-value" th:text="${config.pixChave}">chave-pix</div>
                        <button type="button" class="btn-copy" onclick="copyPix()">Copiar</button>
                    </div>

                    <!-- Titular -->
                    <div th:if="${config.pixNomeTitular != null}" class="pix-titular">
                        <strong>Titular:</strong> <span th:text="${config.pixNomeTitular}">Nome</span>
                        <span th:if="${config.pixBanco != null}" th:text="' - ' + ${config.pixBanco}"></span>
                    </div>

                    <!-- Valor -->
                    <div class="pix-valor">
                        <strong>Valor:</strong>
                        <span th:text="${#numbers.formatCurrency(item.valor)}">R$ 0,00</span>
                    </div>
                </div>
            </div>

            <!-- Coluna Direita: Formulario -->
            <div class="checkout-form">
                <h3>Confirmar Pagamento</h3>
                <p class="checkout-instructions">
                    1. Faca o PIX usando o QR Code ou a chave ao lado<br>
                    2. Preencha seus dados abaixo<br>
                    3. Clique em "Ja fiz o pagamento"
                </p>

                <form th:action="@{/reservar}" th:object="${reservaForm}" method="post">
                    <input type="hidden" th:field="*{itemId}" th:value="${item.id}">

                    <div class="form-group">
                        <label for="nomeConvidado">Seu Nome Completo *</label>
                        <input type="text" id="nomeConvidado" th:field="*{nomeConvidado}"
                               class="form-control" placeholder="Digite seu nome" required>
                        <small th:if="${#fields.hasErrors('nomeConvidado')}" style="color: red;"
                               th:errors="*{nomeConvidado}">Erro</small>
                    </div>

                    <div class="form-group">
                        <label for="emailConvidado">Seu E-mail ou Telefone</label>
                        <input type="text" id="emailConvidado" th:field="*{emailConvidado}"
                               class="form-control" placeholder="Para contato se necessario">
                    </div>

                    <div class="form-group">
                        <label for="mensagem" th:text="${config != null} ? 'Mensagem para ' + ${config.nomePessoa1} + ' e ' + ${config.nomePessoa2} : 'Deixe uma mensagem'">Mensagem</label>
                        <textarea id="mensagem" th:field="*{mensagem}"
                                  class="form-control" placeholder="Escreva uma mensagem especial... (opcional)"></textarea>
                    </div>

                    <div class="checkout-confirm">
                        <label class="checkbox-container">
                            <input type="checkbox" id="confirmaPix" required>
                            <span class="checkmark"></span>
                            Confirmo que ja realizei o pagamento via PIX
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block btn-lg">
                        Ja fiz o pagamento
                    </button>
                </form>

                <div style="margin-top: 20px; text-align: center;">
                    <a th:href="@{/item/{id}(id=${item.id})}" class="btn btn-secondary">Voltar</a>
                </div>
            </div>
        </div>
    </div>
</main>

<footer th:replace="~{fragments/footer :: footer}"></footer>

<script th:inline="javascript">
function copyPix() {
    const pixChave = /*[[${config.pixChave}]]*/ '';
    navigator.clipboard.writeText(pixChave).then(function() {
        alert('Chave PIX copiada!');
    });
}
</script>

<style>
.checkout-wrapper {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: 40px;
}

.checkout-summary {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
}

.summary-item {
    text-align: center;
    padding-bottom: 20px;
    border-bottom: 1px solid #ddd;
    margin-bottom: 20px;
}

.summary-item img {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 15px;
}

.summary-placeholder {
    width: 100%;
    height: 150px;
    background: linear-gradient(135deg, var(--cor-primaria) 0%, var(--cor-secundaria) 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 4rem;
    color: white;
    margin-bottom: 15px;
}

.summary-item h3 {
    margin-bottom: 10px;
    color: #333;
}

.summary-price {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--cor-primaria);
}

.pix-section {
    text-align: center;
}

.pix-section h4 {
    color: #333;
    margin-bottom: 20px;
}

.qrcode-box {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.qrcode-img {
    max-width: 200px;
    border-radius: 10px;
}

.qrcode-box p {
    margin-top: 10px;
    color: #666;
    font-size: 0.9rem;
}

.pix-divider {
    position: relative;
    margin: 20px 0;
    text-align: center;
}

.pix-divider::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    width: 100%;
    height: 1px;
    background: #ddd;
}

.pix-divider span {
    background: #f8f9fa;
    padding: 0 15px;
    color: #888;
    font-size: 0.9rem;
    position: relative;
}

.pix-key-box {
    background: white;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.pix-key-label {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 5px;
}

.pix-key-value {
    font-family: monospace;
    font-size: 1rem;
    color: #333;
    word-break: break-all;
    margin-bottom: 10px;
}

.btn-copy {
    background: var(--cor-primaria);
    color: white;
    border: none;
    padding: 8px 20px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 0.9rem;
}

.btn-copy:hover {
    opacity: 0.9;
}

.pix-titular, .pix-valor {
    color: #666;
    font-size: 0.9rem;
    margin-top: 10px;
}

.pix-valor {
    font-size: 1.1rem;
    color: #333;
}

.checkout-form h3 {
    margin-bottom: 10px;
}

.checkout-instructions {
    color: #666;
    font-size: 0.95rem;
    line-height: 1.8;
    margin-bottom: 25px;
    padding: 15px;
    background: #f0f7ff;
    border-radius: 10px;
}

.checkout-confirm {
    margin: 25px 0;
}

.checkbox-container {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 0.95rem;
    color: #333;
}

.checkbox-container input {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.btn-lg {
    padding: 15px 30px;
    font-size: 1.1rem;
}

@media (max-width: 768px) {
    .checkout-wrapper {
        grid-template-columns: 1fr;
    }
}
</style>

</body>
</html>
